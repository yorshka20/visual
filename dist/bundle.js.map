{"version":3,"file":"bundle.js","sources":["../node_modules/tslib/tslib.es6.js","../src/canvas/canvas.ts","../src/config/index.ts","../src/eventBus/EventBus.ts","../src/eventBus/EventTypes.ts","../src/eventBus/index.ts","../src/mesh/interface.ts","../src/mesh/utils.ts","../src/highlight/highlight.ts","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../node_modules/lodash/throttle.js","../src/interaction/interaction.ts","../src/shape/utils.ts","../src/mesh/mesh.ts","../src/shape/shape.ts","../src/demo/utils.ts","../src/demo/demo.ts","../src/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-29 22:43:14\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 17:26:28\r\n *\r\n * 自定义canvas类型，大小与容器一致\r\n */\r\n\r\nimport { CanvasOptions } from './interface';\r\n\r\nexport default class Canvas {\r\n  // 挂载容器\r\n  protected container: HTMLElement | null;\r\n  // DOM canvas元素实例(对外暴露)\r\n  public canvasEle: HTMLCanvasElement | null;\r\n  // 2d context\r\n  public ctx: CanvasRenderingContext2D | null;\r\n\r\n  // 宽高\r\n  protected width: number;\r\n  protected height: number;\r\n\r\n  constructor(options: CanvasOptions) {\r\n    const { container, zIndex, hide, id } = options;\r\n\r\n    //   保存canvas挂载容器\r\n    this.container = container;\r\n\r\n    //   创建canvas元素\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = container.clientWidth;\r\n    canvas.height = container.clientHeight;\r\n\r\n    this.width = container.clientWidth;\r\n    this.height = container.clientHeight;\r\n\r\n    // 设置id\r\n    canvas.setAttribute('id', id);\r\n\r\n    //   set absolute position for multiple-layer canvas layout.\r\n    canvas.style.position = 'absolute';\r\n    canvas.style.top = '0';\r\n    canvas.style.left = '0';\r\n\r\n    // 设置z层级\r\n    canvas.style.zIndex = zIndex + '';\r\n\r\n    //   store canvas element\r\n    this.canvasEle = canvas;\r\n    this.ctx = canvas.getContext('2d');\r\n\r\n    // 设置层叠顺序\r\n    this.ctx.globalCompositeOperation = 'source-over';\r\n\r\n    // 初始化stroke样式(default)\r\n    this.ctx.lineWidth = 1;\r\n    this.ctx.strokeStyle = '#000';\r\n\r\n    //   mount canvas element\r\n    if (!hide) {\r\n      this.container!.appendChild(canvas);\r\n    }\r\n  }\r\n}\r\n","// mesh格子大小\r\n// export const GRIDSIZE = 25;\r\n\r\n// 是否渲染网格\r\nexport const SHOW_MESH = true;\r\n\r\n// 是否渲染格点\r\nexport const SHOW_MESH_POINT = true;\r\n\r\n// 是否渲染shape cover的grid\r\nexport const SHOW_SHAPE_GRID = true;\r\n\r\n// 是否渲染高亮框\r\nexport const SHOW_HIGHLIGHT = true;\r\n\r\n// 点击变色色列\r\nexport const COLOR_SET = ['#FF0000', '#EE0000', '#CD0000', '#8B0000'];\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-19 16:24:29\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-29 23:52:35\r\n *\r\n * EventBus 工具类\r\n * 需要从全局作用域iife重构为class，否则会导致无法追踪的匿名监听器残留\r\n */\r\n\r\ninterface Namespace {\r\n  on: (...args: any) => void;\r\n  remove: (...args: any) => void;\r\n  emit: (...args: any) => void;\r\n  eventBucket: NamespaceEventBucket;\r\n}\r\n\r\ninterface NamespaceEventBucket {\r\n  [eventName: string]: EventHandler[];\r\n}\r\n\r\ninterface EventHandler {\r\n  (...args: any): void;\r\n}\r\n\r\nexport default class EventBus {\r\n  private static _instance: EventBus;\r\n\r\n  static get instance(): EventBus {\r\n    if (!this._instance) {\r\n      this._instance = new EventBus();\r\n    }\r\n\r\n    return this._instance;\r\n  }\r\n\r\n  private defaultNamespace: string;\r\n\r\n  private namespaceCache: Map<string, Namespace>;\r\n\r\n  constructor() {\r\n    if (EventBus._instance) {\r\n      return EventBus._instance;\r\n    }\r\n\r\n    this.defaultNamespace = 'default';\r\n    this.namespaceCache = new Map<string, Namespace>();\r\n\r\n    EventBus._instance = this;\r\n  }\r\n\r\n  public clean(): void {\r\n    this.namespaceCache = null;\r\n\r\n    EventBus._instance = null;\r\n  }\r\n\r\n  public namespace(inputName: string): Namespace {\r\n    const name = inputName || this.defaultNamespace; // 命名空间\r\n\r\n    if (this.namespaceCache?.get(name)) {\r\n      return this.namespaceCache.get(name);\r\n    }\r\n\r\n    const namespace: Namespace = {\r\n      on: (key: string, fn: EventHandler) => {\r\n        this.on(name, key, fn);\r\n      },\r\n      remove: (key: string, fn: EventHandler) => {\r\n        this.remove(name, key, fn);\r\n      },\r\n      emit(...args: any) {\r\n        const [event, params] = args;\r\n        const eventHandlers = this.eventBucket?.[event];\r\n        if (eventHandlers?.length) {\r\n          eventHandlers.forEach((handler: EventHandler) => {\r\n            handler(params);\r\n          });\r\n        }\r\n      },\r\n      eventBucket: {}, // 闭包中的事件缓存\r\n    };\r\n\r\n    this.namespaceCache.set(name, namespace);\r\n\r\n    return namespace;\r\n  }\r\n\r\n  // 监听一个事件\r\n  private on = function (name: string, key: string, fn: EventHandler): void {\r\n    const namespace = this.namespaceCache?.get(name);\r\n    if (!namespace) {\r\n      return;\r\n    }\r\n\r\n    const cache = namespace.eventBucket;\r\n    if (!cache[key]) {\r\n      cache[key] = [];\r\n    }\r\n    cache[key].push(fn);\r\n  };\r\n\r\n  // 移除一个事件。如果fn为空，则清空该事件下的所有事件\r\n  private remove = function (\r\n    name: string,\r\n    key: string,\r\n    fn?: EventHandler\r\n  ): void {\r\n    const namespace = this.namespaceCache?.get(name);\r\n    if (!namespace) {\r\n      return;\r\n    }\r\n\r\n    const cache = namespace.eventBucket;\r\n    if (cache[key]) {\r\n      if (fn) {\r\n        for (let i = cache[key].length; i >= 0; i--) {\r\n          if (cache[key][i] === fn) {\r\n            cache[key].splice(i, 1);\r\n          }\r\n        }\r\n      } else {\r\n        cache[key] = [];\r\n      }\r\n    }\r\n  };\r\n}\r\n","/**\r\n * 消息类型\r\n */\r\nexport enum EventTypes {\r\n  MOVE = 'move',\r\n  MOUSEDOWN = 'mousedown',\r\n\r\n  HOVER = 'hover',\r\n  CLICK = 'click',\r\n\r\n  SHAPE = 'shape',\r\n}\r\n\r\n/**\r\n * 消息命名空间\r\n */\r\nexport enum Namespace {\r\n  INTERACTION = 'interaction',\r\n  INIT = 'init',\r\n}\r\n","import EventBus from './EventBus';\r\nimport { EventTypes, Namespace } from './EventTypes';\r\n\r\nconst bus = new EventBus();\r\n\r\nexport { bus as EventBus, EventTypes, Namespace };\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-29 22:35:02\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 18:56:51\r\n */\r\n\r\nimport { CanvasOptions } from '@src/canvas/interface';\r\n\r\nexport interface MeshOptions extends CanvasOptions {\r\n  gridSize: number;\r\n}\r\n\r\nexport interface BoundingBoxData {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n// 包围盒\r\nexport class BoundingBox {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n\r\n  constructor(data: BoundingBoxData) {\r\n    const { x, y, width, height } = data;\r\n    this.x = x;\r\n    this.y = y;\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n}\r\n\r\nexport interface GridCacheList {\r\n  topIndex: number;\r\n  list: string[];\r\n}\r\n\r\nexport interface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-30 13:13:02\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 19:43:52\r\n */\r\n\r\nimport { Shape } from '@src/shape';\r\nimport { BoundingBox } from './interface';\r\n\r\n// 返回一个矩形\r\nexport function computeBoundingBox(shape: Shape): BoundingBox {\r\n  return new BoundingBox({\r\n    x: shape.x - shape.radius,\r\n    y: shape.y - shape.radius,\r\n    width: 2 * shape.radius,\r\n    height: 2 * shape.radius,\r\n  });\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-30 17:18:10\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 20:31:48\r\n *\r\n * 高亮层，绘制鼠标感知状态\r\n */\r\n\r\nimport { Canvas } from '@src/canvas';\r\nimport { CanvasOptions } from '@src/canvas/interface';\r\nimport { EventBus, EventTypes, Namespace } from '@src/eventBus';\r\nimport { computeBoundingBox } from '@src/mesh/utils';\r\nimport { Shape } from '@src/shape';\r\n\r\ninterface HighlightOptions extends CanvasOptions {\r\n  //\r\n}\r\n\r\nexport default class Highlight extends Canvas {\r\n  private _target: Shape; // hover shape id\r\n\r\n  private get hoverTarget() {\r\n    return this._target;\r\n  }\r\n\r\n  private set hoverTarget(val: Shape) {\r\n    if (!val) {\r\n      this.clean();\r\n      return;\r\n    }\r\n\r\n    if (val.id !== this._target?.id || !this._target) {\r\n      this._target = val;\r\n      this.clean();\r\n      this.drawHighlight(val);\r\n    }\r\n  }\r\n\r\n  constructor(options: HighlightOptions) {\r\n    super(options);\r\n\r\n    //   设置高亮stroke颜色\r\n    this.ctx.strokeStyle = '#00FF00';\r\n\r\n    this._target = null;\r\n\r\n    //   初始化监听器\r\n    this.init();\r\n  }\r\n\r\n  public destroy(): void {\r\n    this.uninit();\r\n  }\r\n\r\n  private init(): void {\r\n    EventBus.namespace(Namespace.INTERACTION).on(\r\n      EventTypes.HOVER,\r\n      this.hoverHandler\r\n    );\r\n  }\r\n\r\n  private uninit(): void {\r\n    EventBus.namespace(Namespace.INTERACTION).remove(EventTypes.HOVER);\r\n  }\r\n\r\n  private hoverHandler = (shape: Shape) => {\r\n    this.hoverTarget = shape;\r\n  };\r\n\r\n  // 绘制高亮框\r\n  private drawHighlight(shape: Shape): void {\r\n    const rect = computeBoundingBox(shape);\r\n\r\n    this.ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\r\n  }\r\n\r\n  private clean(): void {\r\n    this.ctx.clearRect(0, 0, this.width, this.height);\r\n  }\r\n}\r\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","var debounce = require('./debounce'),\n    isObject = require('./isObject');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nmodule.exports = throttle;\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-29 23:38:02\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 20:52:58\r\n *\r\n * 交互感知层\r\n */\r\n\r\nimport { Canvas } from '@src/canvas';\r\nimport { EventBus, EventTypes, Namespace } from '@src/eventBus';\r\nimport { Mesh } from '@src/mesh';\r\nimport throttle from 'lodash/throttle';\r\n\r\ninterface InteractionOptions {\r\n  target: Canvas;\r\n}\r\n\r\nexport default class Interaction {\r\n  // 监听目标元素\r\n  private target: HTMLCanvasElement;\r\n\r\n  constructor(options: InteractionOptions) {\r\n    this.target = options.target.canvasEle;\r\n\r\n    this.init();\r\n  }\r\n\r\n  // 销毁\r\n  public destroy(): void {\r\n    this.target.removeEventListener('mousedown', this.mouseDownHandler);\r\n    this.target.removeEventListener('mousemove', this.mouseMoveHandler);\r\n  }\r\n\r\n  // 挂载监听器\r\n  public init(): void {\r\n    this.target.addEventListener('mousedown', this.mouseDownHandler);\r\n    this.target.addEventListener('mousemove', this.mouseMoveHandler);\r\n  }\r\n\r\n  private mouseMoveHandler = (e: MouseEvent) =>\r\n    throttle((e: MouseEvent) => {\r\n      const { offsetX, offsetY } = e;\r\n      // 发送事件\r\n      EventBus.namespace(Namespace.INTERACTION).emit(EventTypes.MOVE, {\r\n        x: offsetX,\r\n        y: offsetY,\r\n      });\r\n    }, 20)(e);\r\n\r\n  private mouseDownHandler = (e: MouseEvent) => {\r\n    const { offsetX, offsetY } = e;\r\n    // 发送事件\r\n    EventBus.namespace(Namespace.INTERACTION).emit(EventTypes.MOUSEDOWN, {\r\n      x: offsetX,\r\n      y: offsetY,\r\n    });\r\n  };\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-30 15:08:51\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 22:00:05\r\n */\r\n\r\nimport { CoverArea } from '.';\r\n\r\n// 获得shape cover的格子\r\nexport function getCoveredGrid(\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  gridSize: number\r\n): string[] {\r\n  const list = [];\r\n\r\n  // boundingBox三顶点： 左上，右上，左下\r\n  const lt = [x - radius < 0 ? 0 : x - radius, y - radius < 0 ? 0 : y - radius];\r\n  const rt = [x + radius, y - radius < 0 ? 0 : y - radius];\r\n  const lb = [x - radius < 0 ? 0 : x - radius, y + radius];\r\n\r\n  // console.log('x,y,radius', x, y, radius);\r\n  // console.log('lt,rt,lb', lt, rt, lb);\r\n\r\n  const xAxis = [Math.floor(lt[0] / gridSize), Math.floor(rt[0] / gridSize)];\r\n  const yAxis = [Math.floor(lt[1] / gridSize), Math.floor(lb[1] / gridSize)];\r\n\r\n  // console.log('xAxis,yAxis', xAxis, yAxis);\r\n\r\n  for (let x = xAxis[0]; x <= xAxis[1]; x++) {\r\n    for (let y = yAxis[0]; y <= yAxis[1]; y++) {\r\n      list.push(`${x}:${y}`);\r\n    }\r\n  }\r\n\r\n  // console.log('list', list);\r\n\r\n  return list;\r\n}\r\n\r\n// 获取point在mesh中最近的grid位置\r\nexport function getMeshGrid(x: number, y: number, gridSize: number): number[] {\r\n  const gx = Math.floor(x / gridSize);\r\n  const gy = Math.floor(y / gridSize);\r\n\r\n  return [gx, gy];\r\n}\r\n\r\n// 计算cover区域\r\nexport function getCoverArea(\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  gridSize: number\r\n): CoverArea {\r\n  const area: CoverArea = {\r\n    x: 0,\r\n    y: 0,\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n\r\n  // boundingBox三顶点： 左上，右上，左下\r\n  const lt = [x - radius < 0 ? 0 : x - radius, y - radius < 0 ? 0 : y - radius];\r\n  const rt = [x + radius, y - radius < 0 ? 0 : y - radius];\r\n  const lb = [x - radius < 0 ? 0 : x - radius, y + radius];\r\n\r\n  const xAxis = [Math.floor(lt[0] / gridSize), Math.floor(rt[0] / gridSize)];\r\n  const yAxis = [Math.floor(lt[1] / gridSize), Math.floor(lb[1] / gridSize)];\r\n\r\n  area.x = xAxis[0] * gridSize;\r\n  area.y = yAxis[0] * gridSize;\r\n  area.width = xAxis[1] * gridSize + gridSize - area.x;\r\n  area.height = yAxis[1] * gridSize + gridSize - area.y;\r\n\r\n  return area;\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-29 22:34:19\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-31 13:21:15\r\n *\r\n * mesh实例，用来作为网格坐标层\r\n */\r\n\r\nimport { Canvas } from '@src/canvas';\r\nimport { SHOW_SHAPE_GRID } from '@src/config';\r\nimport { EventBus, EventTypes, Namespace } from '@src/eventBus';\r\nimport { Shape } from '@src/shape';\r\nimport { getMeshGrid } from '@src/shape/utils';\r\nimport { MeshOptions, GridCacheList, Point } from './interface';\r\n\r\nexport default class Mesh extends Canvas {\r\n  static instance: Mesh;\r\n\r\n  // 缓冲数据集\r\n  shapeBucket: Map<string, Shape>;\r\n\r\n  // 格点缓存，以gridId为key，记录cover该grid的shape的list，shape按zindex倒序排\r\n  gridCache: Map<string, GridCacheList>;\r\n\r\n  // mesh网格格子大小\r\n  gridSize: number;\r\n\r\n  constructor(options: MeshOptions) {\r\n    super(options);\r\n\r\n    if (Mesh.instance) {\r\n      return Mesh.instance;\r\n    }\r\n\r\n    // 初始化缓存\r\n    this.shapeBucket = new Map<string, any>();\r\n    this.gridCache = new Map<string, GridCacheList>();\r\n\r\n    // 记录格点大小\r\n    this.gridSize = options.gridSize;\r\n\r\n    // 初始化监听器\r\n    this.initListener();\r\n\r\n    Mesh.instance = this;\r\n  }\r\n\r\n  public destroy(): void {\r\n    EventBus.namespace(Namespace.INTERACTION).remove(EventTypes.MOVE);\r\n    EventBus.namespace(Namespace.INIT).remove(EventTypes.SHAPE);\r\n    EventBus.namespace(Namespace.INTERACTION).remove(EventTypes.MOUSEDOWN);\r\n  }\r\n\r\n  private initListener(): void {\r\n    // shape初始化事件\r\n    EventBus.namespace(Namespace.INIT).on(\r\n      EventTypes.SHAPE,\r\n      this.handleShapeReady\r\n    );\r\n\r\n    // 鼠标移动事件\r\n    EventBus.namespace(Namespace.INTERACTION).on(\r\n      EventTypes.MOVE,\r\n      this.handleMouseMove\r\n    );\r\n\r\n    // 鼠标点击事件\r\n    EventBus.namespace(Namespace.INTERACTION).on(\r\n      EventTypes.MOUSEDOWN,\r\n      this.handleMouseDown\r\n    );\r\n  }\r\n\r\n  // 监听鼠标移动，计算当前hover shape\r\n  private handleMouseMove = (point: Point) => {\r\n    const grid = getMeshGrid(point.x, point.y, this.gridSize).join(':');\r\n    const cache = this.gridCache.get(grid);\r\n    if (cache) {\r\n      if (cache?.list?.length) {\r\n        const shape = this.shapeBucket.get(cache.list[0]);\r\n        EventBus.namespace(Namespace.INTERACTION).emit(EventTypes.HOVER, shape);\r\n        return;\r\n      }\r\n    }\r\n\r\n    EventBus.namespace(Namespace.INTERACTION).emit(EventTypes.HOVER, null);\r\n  };\r\n\r\n  // 鼠标点击\r\n  private handleMouseDown = (point: Point) => {\r\n    const grid = getMeshGrid(point.x, point.y, this.gridSize).join(':');\r\n    // console.log('grid', grid);\r\n    const cache = this.gridCache.get(grid);\r\n    if (cache) {\r\n      if (cache?.list?.length) {\r\n        const shape = this.shapeBucket.get(cache.list[0]);\r\n        EventBus.namespace(Namespace.INTERACTION).emit(EventTypes.CLICK, shape);\r\n        return;\r\n      }\r\n    }\r\n  };\r\n\r\n  private handleShapeReady = (shape: Shape) => {\r\n    console.log('shape ready', shape);\r\n    this.recordShape(shape);\r\n  };\r\n\r\n  // 录入图形，形成坐标\r\n  public recordShape(shape: Shape): void {\r\n    const { id } = shape;\r\n\r\n    // 记录原始数据\r\n    this.shapeBucket.set(id, shape);\r\n\r\n    // 更新格点缓存\r\n    this.updateGridCache(shape);\r\n  }\r\n\r\n  // 删除图形\r\n  // TODO: 优化性能\r\n  public removeShape(shape: Shape): void {\r\n    const { id, meshGridList, zIndex } = shape;\r\n    this.shapeBucket.delete(id);\r\n\r\n    meshGridList.forEach((grid) => {\r\n      const cache = this.gridCache.get(grid);\r\n      if (cache) {\r\n        cache.list = cache.list.filter((i) => i != id);\r\n        if (cache.topIndex == zIndex && cache.list.length) {\r\n          const topShape = this.shapeBucket.get(cache.list[0]);\r\n          cache.topIndex = topShape.zIndex;\r\n        }\r\n\r\n        this.gridCache.set(grid, cache);\r\n      }\r\n    });\r\n  }\r\n\r\n  // 格点缓存\r\n  private updateGridCache(shape: Shape): void {\r\n    const { id, meshGridList, zIndex } = shape;\r\n    meshGridList.forEach((grid) => {\r\n      let cache = this.gridCache.get(grid);\r\n      if (!cache) {\r\n        cache = {\r\n          list: [],\r\n          topIndex: 0,\r\n        };\r\n      }\r\n      let { topIndex, list } = cache;\r\n      // 更新最大zindex\r\n      if (zIndex > topIndex) {\r\n        topIndex = zIndex;\r\n        list.unshift(id);\r\n      } else {\r\n        list.push(id);\r\n      }\r\n\r\n      // 更新缓存\r\n      this.gridCache.set(grid, { topIndex, list });\r\n\r\n      if (SHOW_SHAPE_GRID) {\r\n        // debug\r\n        this.fillGrid(grid);\r\n      }\r\n    });\r\n  }\r\n\r\n  // 辅助方法：渲染格子\r\n  private fillGrid(grid: string) {\r\n    const [x, y] = grid.split(':').map((i) => Number(i));\r\n    this.ctx.fillStyle = '#666';\r\n    this.ctx.fillRect(\r\n      x * this.gridSize,\r\n      y * this.gridSize,\r\n      this.gridSize,\r\n      this.gridSize\r\n    );\r\n  }\r\n\r\n  // 渲染网格坐标\r\n  public renderGrid(): void {\r\n    const ctx = this.ctx;\r\n\r\n    ctx.lineWidth = 0.5;\r\n    ctx.strokeStyle = '#d2e2f7';\r\n\r\n    const gridSize = this.gridSize;\r\n\r\n    const xStart = 0;\r\n    const xEnd = this.container.clientWidth;\r\n    const yStart = 0;\r\n    const yEnd = this.container.clientHeight;\r\n\r\n    ctx.beginPath();\r\n\r\n    // 画网格, x axios\r\n    for (let x = xStart; x <= xEnd + gridSize; x += gridSize) {\r\n      // 超出坐标系绘制，防止有空隙\r\n      ctx.moveTo(x, yStart - gridSize);\r\n      ctx.lineTo(x, yEnd + gridSize);\r\n    }\r\n    // 画网格, y axios\r\n    for (let y = yStart; y <= yEnd + gridSize; y += gridSize) {\r\n      // 超出坐标系绘制，防止有空隙\r\n      ctx.moveTo(xStart - gridSize, y);\r\n      ctx.lineTo(xEnd + gridSize, y);\r\n    }\r\n\r\n    const xOffset = 0;\r\n    const yOffset = 0;\r\n\r\n    // 画格线交点\r\n    for (let x = xStart - gridSize; x <= xEnd; x += gridSize) {\r\n      for (let y = yStart - gridSize; y <= yEnd; y += gridSize) {\r\n        if (\r\n          Math.abs(x + xOffset) % 100 == 0 &&\r\n          Math.abs(y + yOffset) % 100 == 0\r\n        ) {\r\n          ctx.strokeStyle = '#000';\r\n          ctx.strokeText(\r\n            `(${(x + xOffset) / gridSize},${(y + yOffset) / gridSize})`,\r\n            x + 1,\r\n            y - 1\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    ctx.closePath();\r\n\r\n    ctx.stroke();\r\n  }\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-29 23:04:21\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-31 13:28:16\r\n *\r\n * shape类型，用来储存需要被绘制的数据\r\n */\r\n\r\nimport { EventBus, EventTypes, Namespace } from '@src/eventBus';\r\nimport { Mesh } from '@src/mesh';\r\nimport { getCoverArea, getCoveredGrid } from './utils';\r\nimport { ShapeOptions, CoverArea } from './interface';\r\nexport default class Shape {\r\n  // 唯一id\r\n  id: string;\r\n\r\n  // ellipse 类型参数\r\n  x: number;\r\n  y: number;\r\n  radius: number;\r\n\r\n  // 填充颜色\r\n  fillColor: string;\r\n\r\n  // cover到的grid的区域\r\n  coverArea: CoverArea;\r\n\r\n  // 格点大小\r\n  gridSize: number;\r\n\r\n  // 层级参数\r\n  zIndex: number;\r\n\r\n  // 自身格点缓存信息\r\n  meshGridList: string[];\r\n\r\n  constructor(options: ShapeOptions) {\r\n    const { x, y, radius, zIndex } = options;\r\n\r\n    //   保存原始数据\r\n    this.x = x;\r\n    this.y = y;\r\n    this.radius = radius;\r\n    this.zIndex = zIndex;\r\n    this.coverArea = {\r\n      x: 0,\r\n      y: 0,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n\r\n    this.fillColor = '#00BFFF';\r\n\r\n    //   生成随机id\r\n    this.id = Math.random().toString(36).substring(2);\r\n\r\n    // shape晚于mesh实例化，所以此时mesh必定已经实例化完成\r\n    this.gridSize = Mesh.instance.gridSize;\r\n\r\n    // 初始化缓存\r\n    this.initCache();\r\n  }\r\n\r\n  // 初始化缓存\r\n  // 1. 找出所有覆盖到的grid\r\n  // 2. 记录每个grid的id\r\n  private initCache() {\r\n    setTimeout(() => {\r\n      const gridList = getCoveredGrid(\r\n        this.x,\r\n        this.y,\r\n        this.radius,\r\n        this.gridSize\r\n      );\r\n\r\n      // 记录cover区域，用于局部擦除\r\n      this.coverArea = getCoverArea(this.x, this.y, this.radius, this.gridSize);\r\n\r\n      this.meshGridList = gridList;\r\n      console.log('finish cache: ', this.zIndex, this.id);\r\n      EventBus.namespace(Namespace.INIT).emit(EventTypes.SHAPE, this);\r\n    }, 0);\r\n  }\r\n\r\n  public setColor(color: string): void {\r\n    this.fillColor = color;\r\n  }\r\n\r\n  public levelUp(): void {\r\n    this.zIndex += 1;\r\n  }\r\n\r\n  // 自身渲染\r\n  public render(ctx: CanvasRenderingContext2D): void {\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    // 描边\r\n    ctx.beginPath();\r\n    ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n\r\n    // 填充\r\n    ctx.beginPath();\r\n    ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);\r\n    ctx.fillStyle = this.fillColor;\r\n    ctx.fill();\r\n    ctx.closePath();\r\n  }\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-30 20:58:08\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 21:00:28\r\n */\r\n\r\nimport { COLOR_SET } from '@src/config';\r\n\r\nexport function getNextColor(color: string): string {\r\n  const index = COLOR_SET.indexOf(color);\r\n  if (index >= 0) {\r\n    if (index + 1 < COLOR_SET.length) {\r\n      return COLOR_SET[index + 1];\r\n    }\r\n  }\r\n\r\n  return COLOR_SET[0];\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-29 10:25:35\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-31 13:28:23\r\n *\r\n * canvas demo.\r\n *\r\n */\r\n\r\nimport { Canvas } from '@src/canvas';\r\nimport { SHOW_HIGHLIGHT, SHOW_MESH } from '@src/config';\r\nimport { EventBus, EventTypes, Namespace } from '@src/eventBus';\r\nimport { Highlight } from '@src/highlight';\r\nimport { Interaction } from '@src/interaction';\r\nimport { Mesh } from '@src/mesh';\r\nimport { CoverArea, Shape } from '@src/shape';\r\nimport { DemoOptions } from './interface';\r\nimport { getNextColor } from './utils';\r\n\r\nexport default class Demo {\r\n  // 容器及实例\r\n  private container: HTMLElement | null;\r\n\r\n  private width: number;\r\n  private height: number;\r\n\r\n  // 粗粒化格子大小\r\n  private gridSize = 20;\r\n\r\n  // 交互控制句柄，可取消监听器\r\n  private interactionHandler: Interaction;\r\n\r\n  /* 按层级排列 */\r\n  // 鼠标事件感知层\r\n  private interactionLayer: Canvas;\r\n  // 缓存层\r\n  private cacheLayer: Canvas = null;\r\n  // 主画布\r\n  private displayLayer: Canvas;\r\n  // 坐标层\r\n  private meshLayer: Mesh;\r\n\r\n  constructor(options: DemoOptions) {\r\n    const { container: name } = options;\r\n\r\n    const container = document.getElementById(\r\n      name || 'container'\r\n    ) as HTMLElement;\r\n    // 保存容器\r\n    this.container = container;\r\n\r\n    this.width = container.clientWidth;\r\n    this.height = container.clientHeight;\r\n\r\n    // 鼠标动作感知图层\r\n    this.interactionLayer = new Canvas({\r\n      id: 'interaction',\r\n      container,\r\n      zIndex: 4,\r\n    });\r\n\r\n    // cache层，快速擦除，内容较少\r\n    if (SHOW_HIGHLIGHT) {\r\n      this.cacheLayer = new Highlight({\r\n        id: 'cache',\r\n        container,\r\n        zIndex: 3,\r\n      });\r\n    }\r\n\r\n    // 主画布\r\n    this.displayLayer = new Canvas({\r\n      id: 'main',\r\n      container,\r\n      zIndex: 2,\r\n    });\r\n\r\n    // 网格画布，用作坐标感知\r\n    this.meshLayer = new Mesh({\r\n      id: 'mesh',\r\n      container,\r\n      zIndex: 1,\r\n      // hide: true,\r\n      gridSize: this.gridSize,\r\n    });\r\n\r\n    // 渲染网格背景\r\n    if (SHOW_MESH) {\r\n      this.meshLayer.renderGrid();\r\n    }\r\n\r\n    // 交互handler\r\n    this.interactionHandler = new Interaction({\r\n      target: this.interactionLayer,\r\n    });\r\n\r\n    this.initListener();\r\n  }\r\n\r\n  public initListener(): void {\r\n    EventBus.namespace(Namespace.INTERACTION).on(\r\n      EventTypes.CLICK,\r\n      this.clickHandler\r\n    );\r\n    // EventBus.namespace(Namespace.INTERACTION).on(\r\n    //   EventTypes.MOVE,\r\n    //   this.moveHandler\r\n    // );\r\n    // EventBus.namespace(Namespace.INTERACTION).on(\r\n    //   EventTypes.HOVER,\r\n    //   this.hoverHandler\r\n    // );\r\n  }\r\n\r\n  public uninit(): void {\r\n    EventBus.namespace(Namespace.INTERACTION).remove(EventTypes.CLICK);\r\n    // EventBus.namespace(Namespace.INTERACTION).remove(EventTypes.MOVE);\r\n    // EventBus.namespace(Namespace.INTERACTION).remove(EventTypes.HOVER);\r\n  }\r\n\r\n  // 点击元素\r\n  private clickHandler = (shape: Shape) => {\r\n    console.log('click', shape);\r\n    const { fillColor, meshGridList } = shape;\r\n    // 更新颜色\r\n    shape.setColor(getNextColor(fillColor));\r\n    // 更新位置\r\n    shape.levelUp();\r\n\r\n    // 1. 局部擦除\r\n    // 2. 按照zindex重绘被擦除的元素\r\n\r\n    // 建立局部刷新区域\r\n    // 待重绘shape\r\n    let reRenderShape: string[] = [];\r\n    // 记录待重绘元素\r\n    meshGridList.forEach((grid) => {\r\n      const cache = this.meshLayer.gridCache.get(grid);\r\n      if (cache) {\r\n        reRenderShape = [...reRenderShape, ...cache.list];\r\n      }\r\n    });\r\n\r\n    console.log('clearArea', shape.coverArea);\r\n    reRenderShape = [...new Set([...reRenderShape])];\r\n    console.log('reRenderShape', reRenderShape);\r\n    // 擦除\r\n    this.clearGrid(shape.coverArea);\r\n    // 重绘\r\n    this.reRender(reRenderShape, shape);\r\n  };\r\n\r\n  // 局部擦除\r\n  private clearGrid(area: CoverArea): void {\r\n    this.getCtx().clearRect(area.x, area.y, area.width, area.height);\r\n  }\r\n\r\n  // 局部重绘\r\n  private reRender(list: string[], targetShape: Shape): void {\r\n    // targetShape最后render\r\n    // 按zindex顺序绘制\r\n    const shapeList = list.map((id) => this.meshLayer.shapeBucket.get(id));\r\n    shapeList.sort((a, b) => b.zIndex - a.zIndex);\r\n    // console.log('shapeList', shapeList);\r\n    const ctx = this.getCtx();\r\n    shapeList.forEach((shape) => {\r\n      shape.render(ctx);\r\n    });\r\n\r\n    // 最后绘制\r\n    targetShape.render(ctx);\r\n  }\r\n\r\n  // 销毁（其实不用调用）\r\n  public destroy() {\r\n    // 取消监听器\r\n    this.interactionHandler.destroy();\r\n    // 解除eventBus\r\n    this.uninit();\r\n  }\r\n\r\n  public getCtx(): CanvasRenderingContext2D {\r\n    return this.displayLayer.ctx;\r\n  }\r\n\r\n  // 生成count个随机shape\r\n  public generateShape(count: number): Shape[] {\r\n    const list = [];\r\n\r\n    while (count) {\r\n      const shape = new Shape({\r\n        x: Math.floor(Math.random() * this.width),\r\n        y: Math.floor(Math.random() * this.height),\r\n        radius: Math.floor(Math.random() * 10 + 30), // 30 ~ 40\r\n        zIndex: count,\r\n      });\r\n      list.push(shape);\r\n\r\n      count--;\r\n    }\r\n\r\n    return list;\r\n  }\r\n}\r\n","/*\r\n * @Author: yorshka\r\n * @Date: 2021-01-29 22:19:49\r\n * @Last Modified by: yorshka\r\n * @Last Modified time: 2021-01-30 21:16:48\r\n *\r\n * demo: 数百个圆，随机排布，可被鼠标点击。点击后变色并置于顶层，其他圆的绘制顺序不变。\r\n */\r\n\r\nimport { Demo } from './demo';\r\n\r\n// 新建demo实例\r\nconst demo = new Demo({\r\n  container: 'container',\r\n});\r\n\r\nwindow.demo = demo;\r\n\r\n// 生成图形\r\nconst shapeList = demo.generateShape(100);\r\n\r\n// 渲染图像\r\nconst ctx = demo.getCtx();\r\nshapeList.forEach((shape) => {\r\n  shape.render(ctx);\r\n});\r\n\r\n// 退出时销毁实例\r\nwindow.onunload = () => {\r\n  demo.destroy();\r\n};\r\n"],"names":["EventBus","global","freeGlobal","root","Symbol","objectProto","nativeObjectToString","symToStringTag","getRawTag","objectToString","isObjectLike","baseGetTag","isSymbol","isObject","toNumber","now","FUNC_ERROR_TEXT","debounce","throttle"],"mappings":"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"}